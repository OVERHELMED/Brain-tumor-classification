<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Brain MRI Tumor Classification Demo</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.2rem;
            opacity: 0.9;
        }

        .demo-card {
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
            margin-bottom: 30px;
        }

        .card-header {
            background: linear-gradient(45deg, #2196F3, #21CBF3);
            color: white;
            padding: 20px;
            text-align: center;
        }

        .card-body {
            padding: 30px;
        }

        .upload-area {
            border: 3px dashed #ddd;
            border-radius: 10px;
            padding: 40px;
            text-align: center;
            transition: all 0.3s ease;
            cursor: pointer;
            margin-bottom: 20px;
        }

        .upload-area:hover {
            border-color: #2196F3;
            background-color: #f8f9ff;
        }

        .upload-area.dragover {
            border-color: #21CBF3;
            background-color: #e3f2fd;
        }

        .upload-icon {
            font-size: 3rem;
            color: #2196F3;
            margin-bottom: 20px;
        }

        .upload-text {
            font-size: 1.1rem;
            margin-bottom: 10px;
        }

        .upload-hint {
            color: #666;
            font-size: 0.9rem;
        }

        .file-input {
            display: none;
        }

        .btn {
            background: linear-gradient(45deg, #2196F3, #21CBF3);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 10px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(33, 150, 243, 0.4);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .results-area {
            margin-top: 30px;
            display: none;
        }

        .prediction-result {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .result-header {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
        }

        .result-icon {
            font-size: 2rem;
            margin-right: 15px;
        }

        .result-icon.glioma { color: #f44336; }
        .result-icon.meningioma { color: #ff9800; }
        .result-icon.pituitary { color: #9c27b0; }
        .result-icon.no-tumor { color: #4caf50; }

        .result-title {
            font-size: 1.5rem;
            font-weight: bold;
        }

        .confidence-bar {
            width: 100%;
            height: 20px;
            background-color: #e0e0e0;
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0;
        }

        .confidence-fill {
            height: 100%;
            transition: width 0.8s ease;
            border-radius: 10px;
        }

        .confidence-high { background-color: #4caf50; }
        .confidence-medium { background-color: #ff9800; }
        .confidence-low { background-color: #f44336; }

        .probabilities {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .prob-item {
            background: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .prob-label {
            font-weight: bold;
            margin-bottom: 5px;
        }

        .prob-bar {
            width: 100%;
            height: 8px;
            background-color: #e0e0e0;
            border-radius: 4px;
            overflow: hidden;
        }

        .prob-fill {
            height: 100%;
            background-color: #2196F3;
            transition: width 0.6s ease;
        }

        .image-preview {
            max-width: 300px;
            max-height: 300px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            margin: 20px auto;
            display: block;
        }

        .loading {
            text-align: center;
            padding: 20px;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #2196F3;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .error {
            background-color: #ffebee;
            color: #c62828;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #f44336;
            margin: 20px 0;
        }

        .success {
            background-color: #e8f5e8;
            color: #2e7d32;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #4caf50;
            margin: 20px 0;
        }

        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .info-card {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }

        .info-icon {
            font-size: 2rem;
            color: #2196F3;
            margin-bottom: 10px;
        }

        .disclaimer {
            background: #fff3e0;
            border: 1px solid #ffcc02;
            border-radius: 10px;
            padding: 20px;
            margin-top: 30px;
        }

        .disclaimer-icon {
            color: #ff9800;
            font-size: 1.5rem;
            margin-right: 10px;
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .card-body {
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1><i class="fas fa-brain"></i> Brain MRI Tumor Classification</h1>
            <p>AI-Powered Medical Image Analysis Demo</p>
        </div>

        <div class="demo-card">
            <div class="card-header">
                <h2><i class="fas fa-upload"></i> Upload Brain MRI Image</h2>
                <p>Drag and drop an MRI image or click to browse</p>
            </div>
            <div class="card-body">
                <div class="upload-area" id="uploadArea">
                    <div class="upload-icon">
                        <i class="fas fa-cloud-upload-alt"></i>
                    </div>
                    <div class="upload-text">Click here or drag an image to upload</div>
                    <div class="upload-hint">Supported formats: PNG, JPG, JPEG, BMP, TIFF</div>
                    <input type="file" id="fileInput" class="file-input" accept="image/*">
                </div>
                
                <div class="text-center">
                    <button class="btn" id="uploadBtn" onclick="document.getElementById('fileInput').click()">
                        <i class="fas fa-folder-open"></i>
                        Choose File
                    </button>
                    <button class="btn" id="predictBtn" onclick="predictImage()" disabled>
                        <i class="fas fa-magic"></i>
                        Analyze Image
                    </button>
                </div>

                <div id="loadingArea" class="loading" style="display: none;">
                    <div class="spinner"></div>
                    <p>Analyzing MRI image...</p>
                </div>

                <div id="resultsArea" class="results-area">
                    <div id="predictionResult" class="prediction-result">
                        <!-- Results will be populated here -->
                    </div>
                </div>

                <div id="errorArea" style="display: none;">
                    <!-- Errors will be displayed here -->
                </div>
            </div>
        </div>

        <div class="demo-card">
            <div class="card-header">
                <h2><i class="fas fa-info-circle"></i> Model Information</h2>
            </div>
            <div class="card-body">
                <div class="info-grid">
                    <div class="info-card">
                        <div class="info-icon"><i class="fas fa-microchip"></i></div>
                        <h3>Architecture</h3>
                        <p>MobileNetV2 + Classical Classifiers</p>
                    </div>
                    <div class="info-card">
                        <div class="info-icon"><i class="fas fa-tachometer-alt"></i></div>
                        <h3>Performance</h3>
                        <p>96.2% Internal Accuracy</p>
                    </div>
                    <div class="info-card">
                        <div class="info-icon"><i class="fas fa-bolt"></i></div>
                        <h3>Speed</h3>
                        <p>21.9ms Inference Time</p>
                    </div>
                    <div class="info-card">
                        <div class="info-icon"><i class="fas fa-weight"></i></div>
                        <h3>Model Size</h3>
                        <p>2.22M Parameters</p>
                    </div>
                </div>
            </div>
        </div>

        <div class="disclaimer">
            <h3><i class="fas fa-exclamation-triangle disclaimer-icon"></i>Medical Disclaimer</h3>
            <p><strong>Important:</strong> This AI tool is for research and educational purposes only. 
            Results should not be used for medical diagnosis without consultation with qualified healthcare professionals. 
            Always seek professional medical advice for health concerns.</p>
        </div>
    </div>

    <script>
        let selectedFile = null;
        let modelInfo = null;

        // Load model information on page load
        window.onload = async function() {
            try {
                const response = await fetch('/api/model-info');
                if (response.ok) {
                    modelInfo = await response.json();
                    console.log('Model loaded:', modelInfo);
                }
            } catch (error) {
                console.error('Error loading model info:', error);
            }
        };

        // File upload handling
        const uploadArea = document.getElementById('uploadArea');
        const fileInput = document.getElementById('fileInput');
        const predictBtn = document.getElementById('predictBtn');

        // Drag and drop functionality
        uploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadArea.classList.add('dragover');
        });

        uploadArea.addEventListener('dragleave', () => {
            uploadArea.classList.remove('dragover');
        });

        uploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadArea.classList.remove('dragover');
            
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                handleFileSelect(files[0]);
            }
        });

        uploadArea.addEventListener('click', () => {
            fileInput.click();
        });

        fileInput.addEventListener('change', (e) => {
            if (e.target.files.length > 0) {
                handleFileSelect(e.target.files[0]);
            }
        });

        function handleFileSelect(file) {
            // Validate file type
            const allowedTypes = ['image/png', 'image/jpeg', 'image/jpg', 'image/bmp', 'image/tiff'];
            if (!allowedTypes.includes(file.type)) {
                showError('Invalid file type. Please upload PNG, JPG, JPEG, BMP, or TIFF images.');
                return;
            }

            // Validate file size (max 10MB)
            if (file.size > 10 * 1024 * 1024) {
                showError('File size too large. Please upload images smaller than 10MB.');
                return;
            }

            selectedFile = file;
            
            // Show image preview
            const reader = new FileReader();
            reader.onload = function(e) {
                displayImagePreview(e.target.result);
            };
            reader.readAsDataURL(file);

            // Enable predict button
            predictBtn.disabled = false;
            
            // Update upload area
            uploadArea.innerHTML = `
                <div class="upload-icon" style="color: #4caf50;">
                    <i class="fas fa-check-circle"></i>
                </div>
                <div class="upload-text">File selected: ${file.name}</div>
                <div class="upload-hint">Click "Analyze Image" to get prediction</div>
            `;
        }

        function displayImagePreview(imageSrc) {
            const resultsArea = document.getElementById('resultsArea');
            resultsArea.style.display = 'block';
            resultsArea.innerHTML = `
                <div style="text-align: center;">
                    <h3>Selected Image</h3>
                    <img src="${imageSrc}" alt="Selected MRI" class="image-preview">
                </div>
            `;
        }

        async function predictImage() {
            if (!selectedFile) {
                showError('Please select an image first.');
                return;
            }

            // Show loading
            document.getElementById('loadingArea').style.display = 'block';
            document.getElementById('resultsArea').style.display = 'none';
            document.getElementById('errorArea').style.display = 'none';
            predictBtn.disabled = true;

            try {
                const formData = new FormData();
                formData.append('file', selectedFile);

                const response = await fetch('/api/predict', {
                    method: 'POST',
                    body: formData
                });

                const result = await response.json();

                if (result.success) {
                    displayResults(result);
                } else {
                    showError(result.error || 'Prediction failed');
                }
            } catch (error) {
                showError('Network error: ' + error.message);
            } finally {
                document.getElementById('loadingArea').style.display = 'none';
                predictBtn.disabled = false;
            }
        }

        function displayResults(result) {
            const resultsArea = document.getElementById('resultsArea');
            const prediction = result.prediction;
            const probabilities = result.class_probabilities;

            // Determine confidence level and color
            let confidenceClass = 'confidence-low';
            if (prediction.confidence > 0.8) confidenceClass = 'confidence-high';
            else if (prediction.confidence > 0.6) confidenceClass = 'confidence-medium';

            // Create results HTML
            const resultsHTML = `
                <div style="text-align: center; margin-bottom: 20px;">
                    <img src="${result.image_data}" alt="Analyzed MRI" class="image-preview">
                </div>
                
                <div class="result-header">
                    <div class="result-icon ${prediction.class.toLowerCase().replace(' ', '-')}">
                        <i class="fas ${getClassIcon(prediction.class)}"></i>
                    </div>
                    <div>
                        <div class="result-title">${prediction.class}</div>
                        <div style="color: #666;">${prediction.description}</div>
                    </div>
                </div>

                <div style="margin: 20px 0;">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                        <span><strong>Confidence:</strong></span>
                        <span><strong>${(prediction.confidence * 100).toFixed(1)}%</strong></span>
                    </div>
                    <div class="confidence-bar">
                        <div class="confidence-fill ${confidenceClass}" style="width: ${prediction.confidence * 100}%"></div>
                    </div>
                </div>

                <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; margin: 20px 0;">
                    <div><strong>Risk Level:</strong> ${prediction.risk_level}</div>
                    <div><strong>Inference Time:</strong> ${result.inference_time_ms}ms</div>
                </div>

                <h4 style="margin: 20px 0 10px;">Class Probabilities:</h4>
                <div class="probabilities">
                    ${Object.entries(probabilities).map(([className, prob]) => `
                        <div class="prob-item">
                            <div class="prob-label">${className}</div>
                            <div style="font-size: 0.9rem; margin-bottom: 5px;">${(prob * 100).toFixed(1)}%</div>
                            <div class="prob-bar">
                                <div class="prob-fill" style="width: ${prob * 100}%"></div>
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;

            resultsArea.innerHTML = `<div class="prediction-result">${resultsHTML}</div>`;
            resultsArea.style.display = 'block';
        }

        function getClassIcon(className) {
            const icons = {
                'Glioma': 'fa-exclamation-triangle',
                'Meningioma': 'fa-info-circle',
                'Pituitary': 'fa-circle',
                'No Tumor': 'fa-check-circle'
            };
            return icons[className] || 'fa-question-circle';
        }

        function showError(message) {
            const errorArea = document.getElementById('errorArea');
            errorArea.innerHTML = `<div class="error"><i class="fas fa-exclamation-circle"></i> ${message}</div>`;
            errorArea.style.display = 'block';
        }

        function showSuccess(message) {
            const errorArea = document.getElementById('errorArea');
            errorArea.innerHTML = `<div class="success"><i class="fas fa-check-circle"></i> ${message}</div>`;
            errorArea.style.display = 'block';
        }
    </script>
</body>
</html>
